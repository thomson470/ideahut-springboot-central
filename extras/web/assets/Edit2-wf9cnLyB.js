const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Pick-DwF-q9Ia.js","assets/index-CZ6M6r4H.js","assets/index-CWourn4h.css","assets/format-0B3yNPe0.js","assets/QTooltip-DjcLDuxo.js","assets/QSpace-CwLm70lj.js","assets/QList-BiKbVLpI.js","assets/QInnerLoading-C0Qo2eI0.js","assets/QTable-Djq8-VFi.js","assets/QSelect-C94E7tUG.js","assets/ClosePopup-ClacVTk0.js","assets/TouchPan-DwFn1rMB.js","assets/Index-DhrOtw8O.js"])))=>i.map(i=>d[i]);
import{_ as B,al as E,ap as I,Y as R,a0 as v,r as c,Z as u,$ as N,a3 as L,a4 as d,ac as x,f as o,a5 as n,an as C,ab as q,a7 as g,a8 as b,C as V,a2 as m,a6 as y,F as P,ad as $,ak as h,G as z,ae as _,a9 as k,Q,av as G,aK as K,ao as Y,am as Z}from"./index-CZ6M6r4H.js";import{Q as H,b as S,a as J}from"./format-0B3yNPe0.js";import{Q as U}from"./QTooltip-DjcLDuxo.js";import{Q as A}from"./QSelect-C94E7tUG.js";import{Q as M,a as F,b as W,c as j}from"./QTabPanels-7HKSbxKx.js";import{Q as X,a as ee,b as ae}from"./QPopupProxy-Bi75XexN.js";import{Q as le,a as D}from"./QFab-BrBMhDWh.js";import{C as w}from"./ClosePopup-ClacVTk0.js";import{g as p}from"./Index-DhrOtw8O.js";import"./QResizeObserver-PNlafFmi.js";import"./TouchPan-DwFn1rMB.js";import"./QSpace-CwLm70lj.js";import"./QList-BiKbVLpI.js";import"./QInnerLoading-C0Qo2eI0.js";import"./QTable-Djq8-VFi.js";let a;const te={props:["parameters"],emits:["close"],components:{Pick:E(()=>I(()=>import("./Pick-DwF-q9Ia.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12])))},setup(){return{APP:R,uix:v,id:c(null),is_edit:c(!1),saving:c(!1),index:c(null),fields:c(null),template:c({options:{}}),definition:c({}),parentRow:c(null),row:c(null),replica:c(null),relations:c([]),enums:c({}),options:c({}),loading:c({}),dialog:c({pick:v.dialog.init()})}},created(){a=this,a.fields=[],a.is_edit=!1;let t=p.get.object(a.parameters);a.replica=p.get.number(t.replica,null),a.template=p.get.object(t.template),a.definition=p.get.object(t.definition),a.parentRow=p.get.object(t.parentRow),a.relations=p.get.array(t.relations),a.enums={},u.isObject(a.template.enums)&&Object.keys(a.template.enums).forEach(r=>{a.enums[r]=[null].concat(a.template.enums[r])}),a.options={},u.isObject(a.template.options)&&Object.keys(a.template.options).forEach(r=>{a.options[r]=[null].concat(a.template.options[r])}),a.row=p.get.object(t.row);let s=p.get.array(a.definition.fields);if(s.length){if(u.isObject(t.row)){a.index=t.index,a.id=p.id.fromPk(a.definition.id,t.row._pk_),a.is_edit=u.isDefined(a.id);for(const r of s){let l=p.clone.field(r);l.value=u.getFieldValue(l.name,t.row),l.type==="datetime"&&l.converter==="epoch"?l.value=u.format.date(l.value,{format:l.pattern||null}):l.type==="pick"&&(u.isDefined(l.value)?l.text=u.isFunction(l.format)?l.format(l.value,t.row):l.value+"":l.text=u.isFunction(l.format)?l.format(null,t.row):""),a.is_edit||(l.editable=l.insertable),a.fields.push(l)}}else for(const r of s)if(r.insertable){let l=p.clone.field(r);l.editable=l.insertable,a.fields.push(l)}}},methods:{on_pick_select_click(t){let s=a.template.picks[t.pick];if(!u.isObject(s)){v.error("error.required","label.pick");return}let r=u.isArray(s.relations)?s.relations:[];for(const l of r)l.value=u.getFieldValue(l.source,a.parentRow);v.dialog.show(a.dialog.pick,{template:a.template,field:t,pick:s,relations:r,replica:a.replica})},on_pick_remove_click(t){t.value=void 0,t.text=void 0},on_close_dialog_pick(t){if(t?._pk_){let s=a.dialog.pick.parameters.field,r=u.isFunction(s.format)?s.format(t):t+"";s.value=t,s.text=r}v.dialog.hide(a.dialog.pick)},on_clone_click(){let t=a.row?p.copy(a.row):null;if(t?._pk_){delete t._pk_;let s=a.template.id;s.type==="STANDARD"&&delete t[s.fields[0]]}a.$emit("close",{row:t,is_edit:a.is_edit})},on_save_click(){p.action.save({id:a.id,fields:a.fields,definition:a.definition,replica:a.replica,is_edit:a.is_edit,saving:a.saving,relations:a.relations,onSuccess:function(t){if(a.is_edit===!0){a.saving=!0;let s=p.copy(a.definition.crud);s.id=p.copy(a.id),s.replica=a.replica,N.call({path:"/crud/single",method:"post",data:s,onFinish(){a.saving=!1},onSuccess(r){u.isObject(r)&&(r._grid_id_=a.row._grid_id_,r._pk_=a.row._pk_),a.$emit("close",{row:r,is_edit:a.is_edit,index:a.index})}})}else a.$emit("close",{row:t,is_edit:a.is_edit,index:a.index})}})}}},oe={class:"bg-primary"},ne={class:"q-pa-xs bg-white row"},ie={class:"col-6 text-left"},se={class:"col-6 text-right"},re={class:"col-4 q-pr-xs text-left"},de={class:"col-4 q-pr-xs text-center"},ce={class:"col-4 q-pl-xs text-right"};function pe(t,s,r,l,ue,f){const T=L("Pick");return d(),x(P,null,[o(Y,{style:q("width: "+(t.$q.screen.lt.md?"100%;":"50%;"))},{default:n(()=>[o(C,{class:"q-pa-none header-main",style:q(l.APP?.color?.header?"background: "+l.APP.color.header+" !important;":"")},{default:n(()=>[o(H,{class:"q-pr-none"},{default:n(()=>[o(S,null,{default:n(()=>[o(J,{class:"text-h6 text-white"},{default:n(()=>[g(b(l.definition.title+" - "+(l.is_edit?t.$t("label.edit"):t.$t("label.new"))),1)]),_:1})]),_:1}),o(S,{side:""},{default:n(()=>[V((d(),m(y,{class:"text-caption text-white q-pl-xs q-pr-xs q-mr-xs",flat:"",round:"",glossy:"",icon:"close",disable:l.saving},{default:n(()=>[o(U,null,{default:n(()=>[g(b(t.$t("label.close")),1)]),_:1})]),_:1},8,["disable"])),[[w]])]),_:1})]),_:1})]),_:1},8,["style"]),o(C,{style:{"max-height":"65vh"},class:"q-pa-xs q-mt-xs scroll"},{default:n(()=>[(d(!0),x(P,null,$(l.fields,(e,O)=>(d(),x("div",{key:O,class:"q-mb-xs",style:{width:"100%"}},[e.type==="words"?(d(),m(h,{key:0,type:"text",label:e.label,readonly:!e.editable,modelValue:e.value,"onUpdate:modelValue":i=>e.value=i,filled:"",autogrow:"",style:{"max-height":"200px",overflow:"scroll"}},null,8,["label","readonly","modelValue","onUpdate:modelValue"])):e.type==="option"?(d(),m(A,{key:1,modelValue:e.value,"onUpdate:modelValue":i=>e.value=i,label:e.label,readonly:!e.editable,options:l.options[e.option],"option-value":"value","option-label":"label","emit-value":"","map-options":"",filled:""},null,8,["modelValue","onUpdate:modelValue","label","readonly","options"])):e.type==="enum"?(d(),m(A,{key:2,modelValue:e.value,"onUpdate:modelValue":i=>e.value=i,label:e.label,readonly:!e.editable,options:l.enums[e.enum],"option-value":"value","option-label":"label","emit-value":"","map-options":"",filled:""},null,8,["modelValue","onUpdate:modelValue","label","readonly","options"])):e.type==="datetime"||e.type==="date"||e.type==="time"?(d(),m(h,{key:3,type:"text",label:e.label,readonly:!e.editable,modelValue:e.value,"onUpdate:modelValue":i=>e.value=i,filled:""},{append:n(()=>[o(z,{name:e.type==="time"?"schedule":e.type==="date"?"calendar_month":"event",class:"cursor-pointer"},{default:n(()=>[o(X,{"transition-show":"scale","transition-hide":"scale",cover:"",onBeforeShow:i=>l.uix.calendar.beforeShow(e,"tab","proxy_value","value")},{default:n(()=>[_("div",oe,[o(M,{modelValue:e.tab,"onUpdate:modelValue":i=>e.tab=i,class:"bg-primary text-grey-5 shadow-2 text-subtitle2","no-caps":"","indicator-color":"transparent","active-color":"white"},{default:n(()=>[e.type==="datetime"||e.type==="date"?(d(),m(F,{key:0,name:"date"},{default:n(()=>[_("span",null,b(t.$t("label.date")),1)]),_:1})):k("",!0),e.type==="datetime"||e.type==="time"?(d(),m(F,{key:1,name:"time"},{default:n(()=>[_("span",null,b(t.$t("label.time")),1)]),_:1})):k("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue"]),o(Q),o(W,{modelValue:e.tab,"onUpdate:modelValue":i=>e.tab=i},{default:n(()=>[e.type==="datetime"||e.type==="date"?(d(),m(j,{key:0,name:"date",class:"q-pa-none"},{default:n(()=>[o(ee,{modelValue:e.proxy_value,"onUpdate:modelValue":i=>e.proxy_value=i,mask:e.pattern,square:""},null,8,["modelValue","onUpdate:modelValue","mask"])]),_:2},1024)):k("",!0),e.type==="datetime"||e.type==="time"?(d(),m(j,{key:1,name:"time",class:"q-pa-none"},{default:n(()=>[o(ae,{modelValue:e.proxy_value,"onUpdate:modelValue":i=>e.proxy_value=i,mask:e.pattern,format24h:"",square:""},null,8,["modelValue","onUpdate:modelValue","mask"])]),_:2},1024)):k("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue"]),o(Q),_("div",ne,[_("div",ie,[V(o(y,{label:t.$t("label.cancel"),color:"negative","no-caps":""},null,8,["label"]),[[w]])]),_("div",se,[V(o(y,{label:t.$t("label.ok"),color:"secondary","no-caps":"",onClick:i=>e.value=e.proxy_value},null,8,["label","onClick"]),[[w]])])])])]),_:2},1032,["onBeforeShow"])]),_:2},1032,["name"])]),_:2},1032,["label","readonly","modelValue","onUpdate:modelValue"])):e.type==="pick"?(d(),m(h,{key:4,type:"text",label:e.label,readonly:!e.editable,modelValue:e.text,"onUpdate:modelValue":i=>e.text=i,filled:"",autogrow:""},G({_:2},[e.editable?{name:"append",fn:n(()=>[o(le,{modelValue:e.fab,"onUpdate:modelValue":i=>e.fab=i,icon:"flaky",direction:"left",padding:"none",round:"",dense:"",flat:"",glossy:"",class:"q-ma-none q-pa-none"},{default:n(()=>[o(D,{color:"secondary",icon:"fact_check",round:"",dense:"",glossy:"",onClick:i=>f.on_pick_select_click(e)},{default:n(()=>[o(U,null,{default:n(()=>[g(b(t.$t("label.select")),1)]),_:1})]),_:2},1032,["onClick"]),e.value?(d(),m(D,{key:0,color:"negative",icon:"delete_forever",round:"",dense:"",glossy:"",onClick:i=>f.on_pick_remove_click(e)},{default:n(()=>[o(U,null,{default:n(()=>[g(b(t.$t("label.delete")),1)]),_:1})]),_:2},1032,["onClick"])):k("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),key:"0"}:void 0]),1032,["label","readonly","modelValue","onUpdate:modelValue"])):(d(),m(h,{key:5,type:e.type,label:e.label,readonly:!e.editable,modelValue:e.value,"onUpdate:modelValue":i=>e.value=i,filled:""},null,8,["type","label","readonly","modelValue","onUpdate:modelValue"]))]))),128))]),_:1}),o(Q),o(K,{class:"row"},{default:n(()=>[_("div",re,[V(o(y,{label:t.$t("label.cancel"),color:"negative","no-caps":"",glossy:"",disable:l.saving},null,8,["label","disable"]),[[w]])]),_("div",de,[l.is_edit&&l.definition.copy!==!1?(d(),m(y,{key:0,label:t.$t("label.copy"),color:"purple","no-caps":"",glossy:"",disable:l.saving,onClick:f.on_clone_click},null,8,["label","disable","onClick"])):k("",!0)]),_("div",ce,[o(y,{label:t.$t("label.save"),color:"secondary","no-caps":"",glossy:"",loading:l.saving,onClick:f.on_save_click},null,8,["label","loading","onClick"])])]),_:1})]),_:1},8,["style"]),o(Z,{modelValue:l.dialog.pick.show,"onUpdate:modelValue":s[0]||(s[0]=e=>l.dialog.pick.show=e),persistent:"","transition-show":"slide-down","transition-hide":"slide-down","backdrop-filter":"blur(1px)"},{default:n(()=>[o(T,{parameters:l.dialog.pick.parameters,onClose:f.on_close_dialog_pick},null,8,["parameters","onClose"])]),_:1},8,["modelValue"])],64)}const qe=B(te,[["render",pe]]);export{qe as default};
