const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Pick-je-QxSWw.js","assets/index-3Ds9K3sY.js","assets/index-DH4Oj3ZA.css","assets/format-BYB7LI8Y.js","assets/QTooltip-DTsmNrTK.js","assets/QSpace-CAwOBfmg.js","assets/QTable-B2WsSpTs.js","assets/QList-CSjzfvcx.js","assets/QSelect-ybIcc9Im.js","assets/QInnerLoading-7DJ72R4W.js","assets/ClosePopup-Cf-fI5V5.js","assets/Index-DuSzNtU_.js"])))=>i.map(i=>d[i]);
import{_ as B,ai as O,an as A,r as p,Y as u,$ as E,Z as I,a2 as R,a3 as d,aa as w,f as n,a4 as s,al as U,a6 as v,a7 as y,B as g,a1 as m,a5 as f,F as C,ab as N,ah as h,E as $,aj as _,a8 as k,Q as x,at as L,aI as z,bo as Y,am as Z,ak as G}from"./index-3Ds9K3sY.js";import{Q as H,b as q,a as J}from"./format-BYB7LI8Y.js";import{Q}from"./QTooltip-DTsmNrTK.js";import{Q as S}from"./QSelect-ybIcc9Im.js";import{Q as K,a as P,b as M,c as j}from"./QTabPanels-Dth9Sind.js";import{Q as W,a as X,b as ee}from"./QPopupProxy-C3yyw3d7.js";import{Q as ae,a as F}from"./QFab-xgpS96yX.js";import{C as V}from"./ClosePopup-Cf-fI5V5.js";import{g as c}from"./Index-DuSzNtU_.js";import"./QResizeObserver-BXkVA_nK.js";import"./touch-BjYP5sR0.js";import"./TouchPan-CDLsl8kT.js";import"./QSpace-CAwOBfmg.js";import"./QTable-B2WsSpTs.js";import"./QList-CSjzfvcx.js";import"./QInnerLoading-7DJ72R4W.js";const le={props:["parameters"],emits:["close"],components:{Pick:O(()=>A(()=>import("./Pick-je-QxSWw.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11])))},setup(){return{id:p(null),is_edit:p(!1),saving:p(!1),index:p(null),fields:p(null),template:p({options:{}}),definition:p({}),parentRow:p(null),row:p(null),replica:p(null),relations:p([]),enums:p({}),options:p({}),loading:p({}),dialog:p({pick:{show:!1,field:null,parameters:null}})}},created(){let e=this;e.fields=[],e.is_edit=!1;let t=c.get.object(e.parameters);e.replica=c.get.number(t.replica,null),e.template=c.get.object(t.template),e.definition=c.get.object(t.definition),e.parentRow=c.get.object(t.parentRow),e.relations=c.get.array(t.relations),e.enums={},u.isObject(e.template.enums)&&Object.keys(e.template.enums).forEach(l=>{e.enums[l]=[null].concat(e.template.enums[l])}),e.options={},u.isObject(e.template.options)&&Object.keys(e.template.options).forEach(l=>{e.options[l]=[null].concat(e.template.options[l])}),e.row=c.get.object(t.row);let r=c.get.array(e.definition.fields);if(r.length){if(u.isObject(t.row)){e.index=t.index,e.id=c.id.fromPk(e.definition.id,t.row._pk_),e.is_edit=u.isDefined(e.id);for(const l of r){let o=c.clone.field(l);o.value=u.getFieldValue(o.name,t.row),o.type==="datetime"&&o.converter==="epoch"?o.value=u.format.date(o.value,{format:o.pattern||null}):o.type==="pick"&&(u.isDefined(o.value)?o.text=u.isFunction(o.format)?o.format(o.value,t.row):o.value+"":o.text=u.isFunction(o.format)?o.format(null,t.row):""),e.is_edit||(o.editable=o.insertable),e.fields.push(o)}}else for(const l of r)if(l.insertable){let o=c.clone.field(l);o.editable=o.insertable,e.fields.push(o)}}},methods:{on_pick_select_click(e){let t=this,r=t.template.picks[e.pick];if(!u.isObject(r)){E.error("error.required","label.pick");return}let l=u.isArray(r.relations)?r.relations:[];for(const o of l)o.value=u.getFieldValue(o.source,t.parentRow);t.dialog.pick={show:!0,parameters:{template:t.template,field:e,pick:r,relations:l,replica:t.replica}}},on_pick_remove_click(e){e.value=void 0,e.text=void 0},on_close_dialog_pick(e){let t=this;if(e?._pk_){let r=t.dialog.pick.parameters.field,l=u.isFunction(r.format)?r.format(e):e+"";r.value=e,r.text=l}t.dialog.pick={show:!1,parameters:null,field:null}},on_clone_click(){let e=this,t=e.row?c.copy(e.row):null;if(t?._pk_){delete t._pk_;let r=e.template.id;r.type==="STANDARD"&&delete t[r.fields[0]]}e.$emit("close",{row:t,is_edit:e.is_edit})},on_save_click(){let e=this;c.action.save({id:e.id,fields:e.fields,definition:e.definition,replica:e.replica,is_edit:e.is_edit,saving:e.saving,relations:e.relations,onSuccess:function(t){if(e.is_edit===!0){e.saving=!0;let r=c.copy(e.definition.crud);r.id=c.copy(e.id),r.replica=e.replica,I.call({path:"/crud/single",method:"post",data:r,onFinish(){e.saving=!1},onSuccess(l){u.isObject(l)&&(l._grid_id_=e.row._grid_id_,l._pk_=e.row._pk_),e.$emit("close",{row:l,is_edit:e.is_edit,index:e.index})}})}else e.$emit("close",{row:t,is_edit:e.is_edit,index:e.index})}})},on_before_show_calendar(e){e.proxy_value=e.value,e.tab=e.type==="time"?"time":"date"}}},te={class:"bg-primary"},oe={class:"q-pa-xs bg-white row"},ne={class:"col-6 text-left"},se={class:"col-6 text-right"},ie={class:"col-4 q-pr-xs text-left"},re={class:"col-4 q-pr-xs text-center"},de={class:"col-4 q-pl-xs text-right"};function pe(e,t,r,l,o,b){const D=R("Pick");return d(),w(C,null,[n(Z,{style:Y("width: "+(e.$q.screen.lt.md?"100%;":"50%;"))},{default:s(()=>[n(U,{class:"q-pa-none header-main"},{default:s(()=>[n(H,{class:"q-pr-none"},{default:s(()=>[n(q,null,{default:s(()=>[n(J,{class:"text-h6 text-white"},{default:s(()=>[v(y(l.definition.title+" - "+(l.is_edit?e.$t("label.edit"):e.$t("label.new"))),1)]),_:1})]),_:1}),n(q,{side:""},{default:s(()=>[g((d(),m(f,{class:"text-caption text-white q-pl-xs q-pr-xs q-mr-xs",flat:"",round:"",glossy:"",icon:"close",disable:l.saving},{default:s(()=>[n(Q,null,{default:s(()=>[v(y(e.$t("label.close")),1)]),_:1})]),_:1},8,["disable"])),[[V]])]),_:1})]),_:1})]),_:1}),n(U,{style:{"max-height":"65vh"},class:"q-pa-xs q-mt-xs scroll"},{default:s(()=>[(d(!0),w(C,null,N(l.fields,(a,T)=>(d(),w("div",{key:T,class:"q-mb-xs",style:{width:"100%"}},[a.type==="words"?(d(),m(h,{key:0,type:"text",label:a.label,readonly:!a.editable,modelValue:a.value,"onUpdate:modelValue":i=>a.value=i,filled:"",autogrow:"",style:{"max-height":"200px",overflow:"scroll"}},null,8,["label","readonly","modelValue","onUpdate:modelValue"])):a.type==="option"?(d(),m(S,{key:1,modelValue:a.value,"onUpdate:modelValue":i=>a.value=i,label:a.label,readonly:!a.editable,options:l.options[a.option],"option-value":"value","option-label":"label","emit-value":"","map-options":"",filled:""},null,8,["modelValue","onUpdate:modelValue","label","readonly","options"])):a.type==="enum"?(d(),m(S,{key:2,modelValue:a.value,"onUpdate:modelValue":i=>a.value=i,label:a.label,readonly:!a.editable,options:l.enums[a.enum],"option-value":"value","option-label":"label","emit-value":"","map-options":"",filled:""},null,8,["modelValue","onUpdate:modelValue","label","readonly","options"])):a.type==="datetime"||a.type==="date"||a.type==="time"?(d(),m(h,{key:3,type:"text",label:a.label,readonly:!a.editable,modelValue:a.value,"onUpdate:modelValue":i=>a.value=i,filled:""},{append:s(()=>[n($,{name:a.type==="time"?"schedule":a.type==="date"?"calendar_month":"event",class:"cursor-pointer"},{default:s(()=>[n(W,{"transition-show":"scale","transition-hide":"scale",cover:"",onBeforeShow:i=>b.on_before_show_calendar(a)},{default:s(()=>[_("div",te,[n(K,{modelValue:a.tab,"onUpdate:modelValue":i=>a.tab=i,class:"bg-primary text-grey-5 shadow-2 text-subtitle2","no-caps":"","indicator-color":"transparent","active-color":"white"},{default:s(()=>[a.type==="datetime"||a.type==="date"?(d(),m(P,{key:0,name:"date"},{default:s(()=>[_("span",null,y(e.$t("label.date")),1)]),_:1})):k("",!0),a.type==="datetime"||a.type==="time"?(d(),m(P,{key:1,name:"time"},{default:s(()=>[_("span",null,y(e.$t("label.time")),1)]),_:1})):k("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue"]),n(x),n(M,{modelValue:a.tab,"onUpdate:modelValue":i=>a.tab=i},{default:s(()=>[a.type==="datetime"||a.type==="date"?(d(),m(j,{key:0,name:"date",class:"q-pa-none"},{default:s(()=>[n(X,{modelValue:a.proxy_value,"onUpdate:modelValue":i=>a.proxy_value=i,mask:a.pattern,square:""},null,8,["modelValue","onUpdate:modelValue","mask"])]),_:2},1024)):k("",!0),a.type==="datetime"||a.type==="time"?(d(),m(j,{key:1,name:"time",class:"q-pa-none"},{default:s(()=>[n(ee,{modelValue:a.proxy_value,"onUpdate:modelValue":i=>a.proxy_value=i,mask:a.pattern,format24h:"",square:""},null,8,["modelValue","onUpdate:modelValue","mask"])]),_:2},1024)):k("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue"]),n(x),_("div",oe,[_("div",ne,[g(n(f,{label:e.$t("label.cancel"),color:"negative","no-caps":""},null,8,["label"]),[[V]])]),_("div",se,[g(n(f,{label:e.$t("label.ok"),color:"secondary","no-caps":"",onClick:i=>a.value=a.proxy_value},null,8,["label","onClick"]),[[V]])])])])]),_:2},1032,["onBeforeShow"])]),_:2},1032,["name"])]),_:2},1032,["label","readonly","modelValue","onUpdate:modelValue"])):a.type==="pick"?(d(),m(h,{key:4,type:"text",label:a.label,readonly:!a.editable,modelValue:a.text,"onUpdate:modelValue":i=>a.text=i,filled:"",autogrow:""},L({_:2},[a.editable?{name:"append",fn:s(()=>[n(ae,{modelValue:a.fab,"onUpdate:modelValue":i=>a.fab=i,icon:"flaky",direction:"left",padding:"none",round:"",dense:"",flat:"",glossy:"",class:"q-ma-none q-pa-none"},{default:s(()=>[n(F,{color:"secondary",icon:"fact_check",round:"",dense:"",glossy:"",onClick:i=>b.on_pick_select_click(a)},{default:s(()=>[n(Q,null,{default:s(()=>[v(y(e.$t("label.select")),1)]),_:1})]),_:2},1032,["onClick"]),a.value?(d(),m(F,{key:0,color:"negative",icon:"delete_forever",round:"",dense:"",glossy:"",onClick:i=>b.on_pick_remove_click(a)},{default:s(()=>[n(Q,null,{default:s(()=>[v(y(e.$t("label.delete")),1)]),_:1})]),_:2},1032,["onClick"])):k("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),key:"0"}:void 0]),1032,["label","readonly","modelValue","onUpdate:modelValue"])):(d(),m(h,{key:5,type:a.type,label:a.label,readonly:!a.editable,modelValue:a.value,"onUpdate:modelValue":i=>a.value=i,filled:""},null,8,["type","label","readonly","modelValue","onUpdate:modelValue"]))]))),128))]),_:1}),n(x),n(z,{class:"row"},{default:s(()=>[_("div",ie,[g(n(f,{label:e.$t("label.cancel"),color:"negative","no-caps":"",glossy:"",disable:l.saving},null,8,["label","disable"]),[[V]])]),_("div",re,[l.is_edit&&l.definition.copy!==!1?(d(),m(f,{key:0,label:e.$t("label.copy"),color:"purple","no-caps":"",glossy:"",disable:l.saving,onClick:b.on_clone_click},null,8,["label","disable","onClick"])):k("",!0)]),_("div",de,[n(f,{label:e.$t("label.save"),color:"secondary","no-caps":"",glossy:"",loading:l.saving,onClick:b.on_save_click},null,8,["label","loading","onClick"])])]),_:1})]),_:1},8,["style"]),n(G,{modelValue:l.dialog.pick.show,"onUpdate:modelValue":t[0]||(t[0]=a=>l.dialog.pick.show=a),persistent:"","transition-show":"slide-down","transition-hide":"slide-down","backdrop-filter":"blur(2px)"},{default:s(()=>[n(D,{parameters:l.dialog.pick.parameters,onClose:b.on_close_dialog_pick},null,8,["parameters","onClose"])]),_:1},8,["modelValue"])],64)}const Ce=B(le,[["render",pe]]);export{Ce as default};
