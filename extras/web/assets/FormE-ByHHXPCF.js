const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Pick-B9gV2I69.js","assets/index-DR8vcSVV.js","assets/index-CWourn4h.css","assets/format-B2bnFOAj.js","assets/QTooltip-yDWh9haU.js","assets/QSpace-KGtmaO9N.js","assets/QList-B4LjA0mH.js","assets/QInnerLoading-aglVToLV.js","assets/QTable-Bq8EQDGx.js","assets/QSelect-DRrcuyuj.js","assets/ClosePopup-Dm8m1oe-.js","assets/TouchPan-D6T6wx6r.js","assets/Index-DZCMW3KU.js"])))=>i.map(i=>d[i]);
import{_ as I,al as O,ap as N,Y as L,a0 as y,r as m,Z as p,a3 as $,a4 as r,ac as h,f as o,a5 as s,C as k,a2 as c,an as q,ab as P,a7 as x,a8 as b,a6 as f,ae as _,F as S,ad as z,ak as w,G,aa as g,Q as U,av as K,aK as R,ao as Y,am as Z}from"./index-DR8vcSVV.js";import{Q as H,b as j,a as J}from"./format-B2bnFOAj.js";import{Q as C}from"./QTooltip-yDWh9haU.js";import{Q as T}from"./QSelect-DRrcuyuj.js";import{Q as M,a as F,b as W,c as A}from"./QTabPanels-D42-P5uE.js";import{Q as X,a as ee,b as ae}from"./QPopupProxy-BtBFRHAC.js";import{Q as le,a as B}from"./QFab-CDC9eMVu.js";import{C as Q}from"./ClosePopup-Dm8m1oe-.js";import{T as te}from"./TouchPan-D6T6wx6r.js";import{g as u}from"./Index-DZCMW3KU.js";import"./QResizeObserver-BZLpK1Mj.js";import"./QSpace-KGtmaO9N.js";import"./QList-B4LjA0mH.js";import"./QInnerLoading-aglVToLV.js";import"./QTable-Bq8EQDGx.js";let a;const oe={props:["parameters"],emits:["close"],components:{Pick:O(()=>N(()=>import("./Pick-B9gV2I69.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12])))},setup(){return{APP:L,uix:y,id:m(null),title:m(""),is_edit:m(!1),saving:m(!1),index:m(null),fields:m(null),form:m(null),template:m({options:{},enums:{}}),replica:m(null),relations:m([]),enums:m({}),options:m({}),row:m(null),dialog:m({main:y.dialog.init(()=>a.dialog.main),pick:y.dialog.init()})}},created(){a=this;let l=u.get.object(a.parameters),d=u.get.object(l.form);a.template=u.get.object(l.template),a.replica=l.replica,a.relations=u.get.array(l.relations),a.enums={},p.isObject(a.template.enums)&&Object.keys(a.template.enums).forEach(t=>{a.enums[t]=[null].concat(a.template.enums[t])}),a.options={},p.isObject(a.template.options)&&Object.keys(a.template.options).forEach(t=>{a.options[t]=[null].concat(a.template.options[t])}),a.data=u.get.object(l.data),a.form=d,a.fields=[],a.is_edit=l.is_edit,a.title=(p.isString(d.title)&&d.title!==""?d.title+" - ":"")+(a.is_edit?a.$t("label.edit"):a.$t("label.new"));let v=u.get.array(d.fields);if(a.is_edit){a.id=u.id.fromPk(a.form.id,a.data._pk_);for(const t of v){let n=u.clone.field(t);n.value=p.getFieldValue(n.name,a.data),n.type==="datetime"&&n.converter==="epoch"?n.value=p.format.date(n.value,{format:n.pattern||null}):n.type==="pick"?p.isDefined(n.value)&&(n.text=p.isFunction(n.format)?n.format(n.value,l.row):n.value+""):p.isFunction(n.format)&&(n.text=n.format(n.value,l.row)),(n.insertable===!0||n.editable===!0||n.type==="title")&&a.fields.push(n)}}else for(const t of v)if(t.insertable||t.type==="title"){let n=u.clone.field(t);n.editable=!0,a.fields.push(n)}},methods:{on_pick_select_click(l){let d=a.template.picks[l.pick];if(!p.isObject(d)){y.error("error.required","label.pick");return}y.dialog.show(a.dialog.pick,{template:a.template,field:l,pick:d,replica:a.replica})},on_pick_remove_click(l){l.value=void 0,l.text=void 0},on_close_dialog_pick(l){if(l?._pk_){let d=a.dialog.pick.parameters.field,v=p.isFunction(d.format)?d.format(l):l+"";d.value=l,d.text=v}y.dialog.hide(a.dialog.pick)},on_save_click(){a.form._grid_id_=a.template._grid_id_,u.action.save({id:a.id,fields:a.fields,definition:a.form,replica:a.replica,relations:a.relations,is_edit:a.is_edit,saving:a.saving,onSuccess:function(l){a.$emit("close",{row:l,is_edit:a.is_edit,index:a.index})}})}}},ne={class:"row"},se={key:0,class:"text-h6 text-center text-bold"},ie={class:"bg-primary"},re={class:"q-pa-xs bg-white row"},de={class:"col-6 text-left"},me={class:"col-6 text-right"},ce={class:"col-6 q-pr-xs text-left"},pe={class:"col-6 q-pl-xs text-right"};function ue(l,d,v,t,n,V){const D=$("Pick");return r(),h(S,null,[o(Y,{style:P("width: "+(l.$q.screen.lt.md?"100%;":"50%;")+t.dialog.main.style)},{default:s(()=>[k((r(),c(q,{class:"q-pa-none header-main",style:P(t.APP?.color?.header?"background: "+t.APP.color.header+" !important;":"")},{default:s(()=>[o(H,{class:"q-pr-none"},{default:s(()=>[o(j,null,{default:s(()=>[o(J,{class:"text-h6 text-white"},{default:s(()=>[x(b(t.title),1)]),_:1})]),_:1}),o(j,{side:""},{default:s(()=>[k((r(),c(f,{class:"text-caption text-white q-pl-xs q-pr-xs q-mr-xs",flat:"",round:"",glossy:"",icon:"close",disable:t.saving},{default:s(()=>[o(C,null,{default:s(()=>[x(b(l.$t("label.close")),1)]),_:1})]),_:1},8,["disable"])),[[Q]])]),_:1})]),_:1})]),_:1},8,["style"])),[[te,t.dialog.main.onDrag,void 0,{mouse:!0}]]),o(q,{style:{"max-height":"80vh"},class:"q-pa-xs q-mt-xs scroll"},{default:s(()=>[_("div",ne,[(r(!0),h(S,null,z(t.fields,(e,E)=>(r(),h("div",{key:E,class:"col-md-6 col-sm-12 q-mb-xs",style:{width:"100%"}},[e.type==="title"?(r(),h("div",se,b(e.label),1)):e.type==="words"?(r(),c(w,{key:1,type:"text",label:e.label,readonly:!e.editable,modelValue:e.value,"onUpdate:modelValue":i=>e.value=i,filled:"",autogrow:"",style:{"max-height":"200px",overflow:"scroll"}},null,8,["label","readonly","modelValue","onUpdate:modelValue"])):e.type==="enum"?(r(),c(T,{key:2,modelValue:e.value,"onUpdate:modelValue":i=>e.value=i,label:e.label,readonly:e.editable!==!0,options:t.enums[e.enum],"option-value":"value","option-label":"label","emit-value":"","map-options":"",filled:""},null,8,["modelValue","onUpdate:modelValue","label","readonly","options"])):e.type==="option"?(r(),c(T,{key:3,modelValue:e.value,"onUpdate:modelValue":i=>e.value=i,label:e.label,readonly:e.editable!==!0,options:t.options[e.option],"option-value":"value","option-label":"label","emit-value":"","map-options":"",filled:""},null,8,["modelValue","onUpdate:modelValue","label","readonly","options"])):e.type==="datetime"||e.type==="date"||e.type==="time"?(r(),c(w,{key:4,type:"text",label:e.label,readonly:!e.editable,modelValue:e.value,"onUpdate:modelValue":i=>e.value=i,filled:""},{append:s(()=>[o(G,{name:e.type==="time"?"schedule":e.type==="date"?"calendar_month":"event",class:"cursor-pointer"},{default:s(()=>[o(X,{"transition-show":"scale","transition-hide":"scale",cover:"",onBeforeShow:i=>t.uix.calendar.beforeShow(e,"tab","proxy_value","value")},{default:s(()=>[_("div",ie,[o(M,{modelValue:e.tab,"onUpdate:modelValue":i=>e.tab=i,class:"bg-primary text-grey-5 shadow-2 text-subtitle2",align:"justify","no-caps":"","indicator-color":"transparent","active-color":"white"},{default:s(()=>[e.type==="datetime"||e.type==="date"?(r(),c(F,{key:0,name:"date"},{default:s(()=>[_("span",null,b(l.$t("label.date")),1)]),_:1})):g("",!0),e.type==="datetime"||e.type==="time"?(r(),c(F,{key:1,name:"time"},{default:s(()=>[_("span",null,b(l.$t("label.time")),1)]),_:1})):g("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue"]),o(U),o(W,{modelValue:e.tab,"onUpdate:modelValue":i=>e.tab=i},{default:s(()=>[e.type==="datetime"||e.type==="date"?(r(),c(A,{key:0,name:"date",class:"q-pa-none"},{default:s(()=>[o(ee,{modelValue:e.proxy_value,"onUpdate:modelValue":i=>e.proxy_value=i,mask:e.format,square:""},null,8,["modelValue","onUpdate:modelValue","mask"])]),_:2},1024)):g("",!0),e.type==="datetime"||e.type==="time"?(r(),c(A,{key:1,name:"time",class:"q-pa-none"},{default:s(()=>[o(ae,{modelValue:e.proxy_value,"onUpdate:modelValue":i=>e.proxy_value=i,mask:e.format,format24h:"",square:""},null,8,["modelValue","onUpdate:modelValue","mask"])]),_:2},1024)):g("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue"]),o(U),_("div",re,[_("div",de,[k(o(f,{label:l.$t("label.cancel"),color:"negative","no-caps":""},null,8,["label"]),[[Q]])]),_("div",me,[k(o(f,{label:l.$t("label.ok"),color:"secondary","no-caps":"",onClick:i=>e.value=e.proxy_value},null,8,["label","onClick"]),[[Q]])])])])]),_:2},1032,["onBeforeShow"])]),_:2},1032,["name"])]),_:2},1032,["label","readonly","modelValue","onUpdate:modelValue"])):e.type==="pick"?(r(),c(w,{key:5,type:"text",label:e.label,readonly:!e.editable,modelValue:e.text,"onUpdate:modelValue":i=>e.text=i,filled:""},K({_:2},[e.editable?{name:"append",fn:s(()=>[o(le,{modelValue:e.fab,"onUpdate:modelValue":i=>e.fab=i,icon:"flaky",direction:"left",padding:"none",flat:"",class:"q-ma-none q-pa-none"},{default:s(()=>[o(B,{color:"secondary",icon:"fact_check",onClick:i=>V.on_pick_select_click(e)},{default:s(()=>[o(C,null,{default:s(()=>[x(b(l.$t("label.select")),1)]),_:1})]),_:2},1032,["onClick"]),e.value?(r(),c(B,{key:0,color:"negative",icon:"delete_forever",onClick:i=>V.on_pick_remove_click(e)},{default:s(()=>[o(C,null,{default:s(()=>[x(b(l.$t("label.delete")),1)]),_:1})]),_:2},1032,["onClick"])):g("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),key:"0"}:void 0]),1032,["label","readonly","modelValue","onUpdate:modelValue"])):(r(),c(w,{key:6,type:e.type,label:e.label,readonly:!e.editable,modelValue:e.value,"onUpdate:modelValue":i=>e.value=i,filled:""},null,8,["type","label","readonly","modelValue","onUpdate:modelValue"]))]))),128))])]),_:1}),o(U),o(R,{class:"row"},{default:s(()=>[_("div",ce,[k(o(f,{label:l.$t("label.cancel"),color:"negative","no-caps":"",glossy:"",disable:t.saving},null,8,["label","disable"]),[[Q]])]),_("div",pe,[o(f,{label:l.$t("label.save"),color:"secondary","no-caps":"",glossy:"",loading:t.saving,onClick:V.on_save_click},null,8,["label","loading","onClick"])])]),_:1})]),_:1},8,["style"]),o(Z,{modelValue:t.dialog.pick.show,"onUpdate:modelValue":d[0]||(d[0]=e=>t.dialog.pick.show=e),persistent:"","transition-show":"slide-down","transition-hide":"none","backdrop-filter":"blur(1px)"},{default:s(()=>[o(D,{parameters:t.dialog.pick.parameters,onClose:V.on_close_dialog_pick},null,8,["parameters","onClose"])]),_:1},8,["modelValue"])],64)}const Pe=I(oe,[["render",ue]]);export{Pe as default};
