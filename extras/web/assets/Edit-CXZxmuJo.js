const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Pick-je-QxSWw.js","assets/index-3Ds9K3sY.js","assets/index-DH4Oj3ZA.css","assets/format-BYB7LI8Y.js","assets/QTooltip-DTsmNrTK.js","assets/QSpace-CAwOBfmg.js","assets/QTable-B2WsSpTs.js","assets/QList-CSjzfvcx.js","assets/QSelect-ybIcc9Im.js","assets/QInnerLoading-7DJ72R4W.js","assets/ClosePopup-Cf-fI5V5.js","assets/Index-DuSzNtU_.js","assets/Table2-CwzFkl_y.js","assets/FormE-DXD2BQgD.js","assets/QTabPanels-Dth9Sind.js","assets/QResizeObserver-BXkVA_nK.js","assets/touch-BjYP5sR0.js","assets/QPopupProxy-C3yyw3d7.js","assets/TouchPan-CDLsl8kT.js","assets/QFab-xgpS96yX.js"])))=>i.map(i=>d[i]);
import{_ as G,ai as F,an as T,r as b,Y as m,$ as j,Z as I,a2 as E,a3 as c,aa as w,f as i,a4 as n,al as O,a6 as x,a7 as V,B as Q,a1 as u,a5 as g,F as C,ab as D,ah as q,E as Y,aj as y,a8 as h,Q as P,at as Z,aI as H,bo as J,am as K,ak as S}from"./index-3Ds9K3sY.js";import{Q as M,b as B,a as W}from"./format-BYB7LI8Y.js";import{Q as A}from"./QTooltip-DTsmNrTK.js";import{Q as L}from"./QSelect-ybIcc9Im.js";import{Q as X,a as N,b as $,c as R}from"./QTabPanels-Dth9Sind.js";import{Q as ee,a as le,b as ae}from"./QPopupProxy-C3yyw3d7.js";import{Q as te,a as z}from"./QFab-xgpS96yX.js";import{C as U}from"./ClosePopup-Cf-fI5V5.js";import{g as d}from"./Index-DuSzNtU_.js";import"./QResizeObserver-BXkVA_nK.js";import"./touch-BjYP5sR0.js";import"./TouchPan-CDLsl8kT.js";import"./QSpace-CAwOBfmg.js";import"./QTable-B2WsSpTs.js";import"./QList-CSjzfvcx.js";import"./QInnerLoading-7DJ72R4W.js";const oe={props:["parameters"],emits:["close"],components:{Pick:F(()=>T(()=>import("./Pick-je-QxSWw.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))),Table2:F(()=>T(()=>import("./Table2-CwzFkl_y.js"),__vite__mapDeps([12,1,2,3,4,8,5,6,7,9,11]))),FormE:F(()=>T(()=>import("./FormE-DXD2BQgD.js"),__vite__mapDeps([13,1,2,3,4,8,14,15,16,17,18,19,10,11,5,6,7,9])))},setup(){return{id:b(null),is_edit:b(!1),saving:b(!1),index:b(null),fields:b(null),template:b({options:{}}),row:b(null),replica:b(null),enums:b({}),options:b({}),loading:b({}),dialog:b({form:{show:!1,parameters:null},pick:{show:!1,parameters:null},table:{show:!1,parameters:null}})}},created(){let e=this;e.fields=[],e.is_edit=!1;let t=d.get.object(e.parameters);e.replica=d.get.number(t.replica,null),e.template=d.get.object(t.template),e.enums={},m.isObject(e.template.enums)&&Object.keys(e.template.enums).forEach(a=>{e.enums[a]=[null].concat(e.template.enums[a])}),e.options={},m.isObject(e.template.options)&&Object.keys(e.template.options).forEach(a=>{e.options[a]=[null].concat(e.template.options[a])}),e.row=d.get.object(t.row);let s=d.get.array(e.template.fields);if(s.length){if(m.isObject(t.row)){e.index=t.index,e.id=d.id.fromPk(e.template.id,t.row._pk_),e.is_edit=m.isDefined(e.id);for(const a of s){let o=d.clone.field(a);o.value=m.getFieldValue(o.name,t.row),!m.isDefined(o.value)&&m.isFunction(o.rowToValue)&&(o.value=o.rowToValue(t.row)),o.type==="datetime"&&o.converter==="epoch"?o.value=m.format.date(o.value,{format:o.pattern||null}):o.type==="pick"&&(m.isDefined(o.value)&&o.value!==null?o.text=m.isFunction(o.format)?o.format(o.value,t.row):o.value+"":o.text=m.isFunction(o.format)?o.format(null,t.row):""),e.is_edit||(o.editable=o.insertable),e.fields.push(o)}}else for(const a of s)if(a.insertable){let o=d.clone.field(a);o.editable=o.insertable,e.fields.push(o)}}},methods:{on_form_click(e,t){let s=this,a=d.get.object(s.parameters),o=d.get.object(a.row),p=d.get.array(e.relations);if(!p.length){j.error("error.required","label.relation");return}let k=[];for(const _ of p)_.value=m.getFieldValue(_.source,o),k.push({field:_.target,condition:"EQUAL",value:_.value});let f=d.copy(e.crud);f.filters=m.isArray(f.filters)?f.filters:[],f.filters=f.filters.concat(k),m.isNumber(s.replica)&&(f.replica=s.replica),s.loading["form_"+t]=!0,I.call({path:"/crud/single",method:"post",data:f,onFinish(){s.loading["form_"+t]=!1},onSuccess(_){_=d.get.object(_),d.inject.pkAndGridId(e.id,_,s.template._grid_id_),s.dialog.form={show:!0,parameters:{form:e,template:s.template,row:o,data:_,replica:s.replica,relations:p,is_edit:m.isDefined(_._pk_)}}}})},on_close_dialog_form(){let e=this;e.dialog.form={show:!1,parameters:null}},on_pick_select_click(e){let t=this,s=t.template.picks[e.pick];if(!m.isObject(s)){j.error("error.required","label.pick");return}t.dialog.pick={show:!0,parameters:{template:t.template,field:e,pick:s,replica:t.replica}}},on_pick_remove_click(e){e.value=void 0,e.text=void 0},on_close_dialog_pick(e){let t=this;if(e?._pk_){let s=t.dialog.pick.parameters.field,a=m.isFunction(s.format)?s.format(e):e+"";s.value=e,s.text=a}t.dialog.pick={show:!1,parameters:null,field:null}},on_table_click(e){let t=this,s=d.get.object(t.parameters),a=d.get.object(s.template),o=d.get.object(s.row),p=d.copy(d.get.array(e.relations));if(!p.length){j.error("error.required","label.relation");return}for(const k of p)k.value=m.getFieldValue(k.source,o);e._grid_id_=a._grid_id_,t.dialog.table={show:!0,parameters:{template:a,definition:e,parentRow:o,relations:p,onlyView:!1,replica:t.replica}}},on_close_dialog_table(){let e=this;e.dialog.table={show:!1,parameters:null}},on_clone_click(){let e=this,t=e.row?d.copy(e.row):null;if(t?._pk_){delete t._pk_;let s=e.template.id;s.type==="STANDARD"&&delete t[s.fields[0]]}e.$emit("close",{row:t,is_edit:e.is_edit})},on_save_click(){let e=this;d.action.save({id:e.id,fields:e.fields,definition:e.template,replica:e.replica,is_edit:e.is_edit,saving:e.saving,onSuccess:function(t){if(e.is_edit===!0){e.saving=!0;let s=d.copy(e.template.crud);s.id=d.copy(e.id),s.replica=e.replica,I.call({path:"/crud/single",method:"post",data:s,onFinish(){e.saving=!1},onSuccess(a){m.isObject(a)&&(a._grid_id_=e.row._grid_id_,a._pk_=e.row._pk_),e.$emit("close",{row:a,is_edit:e.is_edit,index:e.index})}})}else e.$emit("close",{row:t,is_edit:e.is_edit,index:e.index})}})},on_before_show_calendar(e){e.proxy_value=e.value,e.tab=e.type==="time"?"time":"date"}}},se={class:"bg-primary"},ie={class:"q-pa-xs bg-white row"},ne={class:"col-6 text-left"},re={class:"col-6 text-right"},de={key:0,class:"q-mb-xs",style:{width:"100%"}},ce={key:1,class:"q-mb-xs",style:{width:"100%"}},me={class:"col-4 q-pr-xs text-left"},pe={class:"col-4 q-pr-xs text-center"},ue={class:"col-4 q-pl-xs text-right"};function _e(e,t,s,a,o,p){const k=E("Pick"),f=E("Table2"),_=E("FormE");return c(),w(C,null,[i(K,{style:J("width: "+(e.$q.screen.lt.md?"100%;":"50%;"))},{default:n(()=>[i(O,{class:"header-main"},{default:n(()=>[i(M,{class:"q-pr-none"},{default:n(()=>[i(B,null,{default:n(()=>[i(W,{class:"text-h6 text-white"},{default:n(()=>[x(V(a.is_edit?e.$t("label.edit"):e.$t("label.new")),1)]),_:1})]),_:1}),i(B,{side:""},{default:n(()=>[Q((c(),u(g,{class:"text-caption text-white q-pl-xs q-pr-xs q-mr-xs",flat:"",round:"",glossy:"",icon:"close",disable:a.saving},{default:n(()=>[i(A,null,{default:n(()=>[x(V(e.$t("label.close")),1)]),_:1})]),_:1},8,["disable"])),[[U]])]),_:1})]),_:1})]),_:1}),i(O,{style:{"max-height":"65vh"},class:"q-pa-xs q-mt-none scroll"},{default:n(()=>[(c(!0),w(C,null,D(a.fields,(l,v)=>(c(),w("div",{key:v,class:"q-mb-xs",style:{width:"100%"}},[l.type==="words"?(c(),u(q,{key:0,type:"text",label:l.label,readonly:!l.editable,modelValue:l.value,"onUpdate:modelValue":r=>l.value=r,filled:"",autogrow:"",style:{"max-height":"200px",overflow:"scroll"}},null,8,["label","readonly","modelValue","onUpdate:modelValue"])):l.type==="option"?(c(),u(L,{key:1,modelValue:l.value,"onUpdate:modelValue":r=>l.value=r,label:l.label,readonly:!l.editable,options:a.options[l.option],"option-value":"value","option-label":"label","emit-value":"","map-options":"",filled:""},null,8,["modelValue","onUpdate:modelValue","label","readonly","options"])):l.type==="enum"?(c(),u(L,{key:2,modelValue:l.value,"onUpdate:modelValue":r=>l.value=r,label:l.label,readonly:!l.editable,options:a.enums[l.enum],"option-value":"value","option-label":"label","emit-value":"","map-options":"",filled:""},null,8,["modelValue","onUpdate:modelValue","label","readonly","options"])):l.type==="datetime"||l.type==="date"||l.type==="time"?(c(),u(q,{key:3,type:"text",label:l.label,readonly:!l.editable,modelValue:l.value,"onUpdate:modelValue":r=>l.value=r,filled:""},{append:n(()=>[i(Y,{name:l.type==="time"?"schedule":l.type==="date"?"calendar_month":"event",class:"cursor-pointer"},{default:n(()=>[i(ee,{"transition-show":"scale","transition-hide":"scale",cover:"",onBeforeShow:r=>p.on_before_show_calendar(l)},{default:n(()=>[y("div",se,[i(X,{modelValue:l.tab,"onUpdate:modelValue":r=>l.tab=r,class:"bg-primary text-grey-5 shadow-2 text-subtitle2","no-caps":"","indicator-color":"transparent","active-color":"white"},{default:n(()=>[l.type==="datetime"||l.type==="date"?(c(),u(N,{key:0,name:"date"},{default:n(()=>[y("span",null,V(e.$t("label.date")),1)]),_:1})):h("",!0),l.type==="datetime"||l.type==="time"?(c(),u(N,{key:1,name:"time"},{default:n(()=>[y("span",null,V(e.$t("label.time")),1)]),_:1})):h("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue"]),i(P),i($,{modelValue:l.tab,"onUpdate:modelValue":r=>l.tab=r},{default:n(()=>[l.type==="datetime"||l.type==="date"?(c(),u(R,{key:0,name:"date",class:"q-pa-none"},{default:n(()=>[i(le,{modelValue:l.proxy_value,"onUpdate:modelValue":r=>l.proxy_value=r,mask:l.pattern,square:""},null,8,["modelValue","onUpdate:modelValue","mask"])]),_:2},1024)):h("",!0),l.type==="datetime"||l.type==="time"?(c(),u(R,{key:1,name:"time",class:"q-pa-none"},{default:n(()=>[i(ae,{modelValue:l.proxy_value,"onUpdate:modelValue":r=>l.proxy_value=r,mask:l.pattern,format24h:"",square:""},null,8,["modelValue","onUpdate:modelValue","mask"])]),_:2},1024)):h("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue"]),i(P),y("div",ie,[y("div",ne,[Q(i(g,{label:e.$t("label.cancel"),color:"negative","no-caps":""},null,8,["label"]),[[U]])]),y("div",re,[Q(i(g,{label:e.$t("label.ok"),color:"secondary","no-caps":"",onClick:r=>l.value=l.proxy_value},null,8,["label","onClick"]),[[U]])])])])]),_:2},1032,["onBeforeShow"])]),_:2},1032,["name"])]),_:2},1032,["label","readonly","modelValue","onUpdate:modelValue"])):l.type==="pick"?(c(),u(q,{key:4,type:"text",label:l.label,readonly:!l.editable,modelValue:l.text,"onUpdate:modelValue":r=>l.text=r,filled:"",autogrow:""},Z({_:2},[l.editable?{name:"append",fn:n(()=>[i(te,{modelValue:l.fab,"onUpdate:modelValue":r=>l.fab=r,icon:"flaky",direction:"left",padding:"none",round:"",dense:"",flat:"",glossy:"",class:"q-ma-none q-pa-none"},{default:n(()=>[i(z,{color:"secondary",icon:"fact_check",round:"",dense:"",glossy:"",onClick:r=>p.on_pick_select_click(l)},{default:n(()=>[i(A,null,{default:n(()=>[x(V(e.$t("label.select")),1)]),_:1})]),_:2},1032,["onClick"]),l.value?(c(),u(z,{key:0,color:"negative",icon:"delete_forever",round:"",dense:"",glossy:"",onClick:r=>p.on_pick_remove_click(l)},{default:n(()=>[i(A,null,{default:n(()=>[x(V(e.$t("label.delete")),1)]),_:1})]),_:2},1032,["onClick"])):h("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),key:"0"}:void 0]),1032,["label","readonly","modelValue","onUpdate:modelValue"])):(c(),u(q,{key:5,type:l.type,label:l.label,readonly:!l.editable,modelValue:l.value,"onUpdate:modelValue":r=>l.value=r,filled:""},null,8,["type","label","readonly","modelValue","onUpdate:modelValue"]))]))),128)),a.is_edit&&a.template.forms?.length?(c(),w("div",de,[(c(!0),w(C,null,D(a.template.forms,(l,v)=>(c(),u(g,{key:v,label:l.title,class:"full-width q-mt-xs q-mb-xs text-weight-bold","no-caps":"",glossy:"",loading:a.loading["form_"+v],onClick:r=>p.on_form_click(l,v)},null,8,["label","loading","onClick"]))),128))])):h("",!0),a.is_edit&&a.template.children?.length?(c(),w("div",ce,[(c(!0),w(C,null,D(a.template.children,(l,v)=>(c(),u(g,{key:v,label:l.title,class:"full-width q-mt-xs q-mb-xs text-weight-bold","no-caps":"",glossy:"",onClick:r=>p.on_table_click(l)},null,8,["label","onClick"]))),128))])):h("",!0)]),_:1}),i(P),i(H,{class:"row"},{default:n(()=>[y("div",me,[Q(i(g,{label:e.$t("label.cancel"),color:"negative","no-caps":"",glossy:"",disable:a.saving},null,8,["label","disable"]),[[U]])]),y("div",pe,[a.is_edit&&a.template.copy!==!1?(c(),u(g,{key:0,label:e.$t("label.copy"),color:"purple","no-caps":"",glossy:"",disable:a.saving,onClick:p.on_clone_click},null,8,["label","disable","onClick"])):h("",!0)]),y("div",ue,[i(g,{label:e.$t("label.save"),color:"secondary","no-caps":"",glossy:"",loading:a.saving,onClick:p.on_save_click},null,8,["label","loading","onClick"])])]),_:1})]),_:1},8,["style"]),i(S,{modelValue:a.dialog.pick.show,"onUpdate:modelValue":t[0]||(t[0]=l=>a.dialog.pick.show=l),persistent:"","transition-show":"slide-down","transition-hide":"none","backdrop-filter":"blur(2px)"},{default:n(()=>[i(k,{parameters:a.dialog.pick.parameters,onClose:p.on_close_dialog_pick},null,8,["parameters","onClose"])]),_:1},8,["modelValue"]),i(S,{modelValue:a.dialog.table.show,"onUpdate:modelValue":t[1]||(t[1]=l=>a.dialog.table.show=l),"transition-show":"slide-down","transition-hide":"none","backdrop-filter":"blur(2px)","full-height":""},{default:n(()=>[i(f,{parameters:a.dialog.table.parameters,onClose:p.on_close_dialog_table},null,8,["parameters","onClose"])]),_:1},8,["modelValue"]),i(S,{modelValue:a.dialog.form.show,"onUpdate:modelValue":t[2]||(t[2]=l=>a.dialog.form.show=l),persistent:"","transition-show":"slide-down","transition-hide":"none","backdrop-filter":"blur(2px)"},{default:n(()=>[i(_,{parameters:a.dialog.form.parameters,onClose:p.on_close_dialog_form},null,8,["parameters","onClose"])]),_:1},8,["modelValue"])],64)}const je=G(oe,[["render",_e]]);export{je as default};
