const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AuditSearch-CtkUHtDA.js","assets/format-BYB7LI8Y.js","assets/index-3Ds9K3sY.js","assets/index-DH4Oj3ZA.css","assets/QTooltip-DTsmNrTK.js","assets/QTabPanels-Dth9Sind.js","assets/QResizeObserver-BXkVA_nK.js","assets/QSelect-ybIcc9Im.js","assets/touch-BjYP5sR0.js","assets/QPopupProxy-C3yyw3d7.js","assets/TouchPan-CDLsl8kT.js","assets/QForm-DrU6uDMp.js","assets/ClosePopup-Cf-fI5V5.js","assets/TableView-j-G_NCZx.js"])))=>i.map(i=>d[i]);
import{_ as x,ai as Y,Y as n,r as b,Z as C,aa as P,f as m,a4 as c,ak as D,F as Q,a2 as N,a3 as v,a5 as y,a1 as w,a8 as k,a6 as q,a7 as h,aj as S,E as B,ah as O,at as F,an as E}from"./index-3Ds9K3sY.js";import{Q as A}from"./QSpace-CAwOBfmg.js";import{Q as z,a as H}from"./QTable-B2WsSpTs.js";import{Q as V}from"./QTooltip-DTsmNrTK.js";import{Q as L}from"./QInnerLoading-7DJ72R4W.js";import"./QList-CSjzfvcx.js";import"./QSelect-ybIcc9Im.js";import"./format-BYB7LI8Y.js";const M={components:{Search:Y(()=>E(()=>import("./AuditSearch-CtkUHtDA.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]))),View:Y(()=>E(()=>import("./TableView-j-G_NCZx.js"),__vite__mapDeps([13,1,2,3,4,12])))},setup(){return{util:n,handler:b(null),manager:b(null),type:b(null),info:b({}),definition:{default:{visibles:[],columns:[]},entity:{visibles:[],columns:[]}},table:b({rows:[],visibles:[],columns:[],pagination:{page:1,rowsPerPage:20,sortBy:"entry",descending:!0,count:!1},loading:!1}),search:b({filters:[],empty:!0}),dialog:b({search:{show:!1,parameters:null},view:{show:!1,parameters:null}})}},created(){let e=this;e.definition.default={visibles:["id","action","replica","auditor","info","type","content","entry"],columns:[{name:"entry",label:e.$t("label.entry"),field:"entry",align:"left",timestamp:!0,pattern:"YYYY-MM-DD HH:mm:ss",sortable:!0,format:function(t,f){return n.format.date(n.getFieldValue("entry",f),{format:"YYYY-MM-DD HH:mm:ss"})}},{name:"id",label:e.$t("label.id"),field:"id",align:"left",type:"java.lang.String",sortable:!0},{name:"action",label:e.$t("label.action"),field:"action",align:"left",type:"java.lang.String",sortable:!0},{name:"replica",label:e.$t("label.replica"),field:"replica",align:"left",type:"java.lang.Integer",sortable:!0},{name:"auditor",label:e.$t("label.auditor"),field:"auditor",align:"left",type:"java.lang.String",sortable:!0},{name:"info",label:e.$t("label.info"),field:"info",align:"left",type:"java.lang.String",sortable:!0},{name:"type",label:e.$t("label.type"),field:"type",align:"left",type:"java.lang.String",sortable:!0},{name:"content",label:e.$t("label.content"),field:"content",align:"left",type:"java.lang.String",sortable:!0}]},e.definition.entity={visibles:["action","replica","auditor","entry"],columns:[{name:"entry",label:e.$t("label.entry"),field:"entry",align:"left",timestamp:!0,pattern:"YYYY-MM-DD HH:mm:ss",sortable:!0,format:function(t,f){return n.format.date(n.getFieldValue("entry",f),{format:"YYYY-MM-DD HH:mm:ss"})}},{name:"action",label:e.$t("label.action"),field:"action",align:"left",type:"java.lang.String",sortable:!0},{name:"replica",label:e.$t("label.replica"),field:"replica",align:"left",type:"java.lang.Integer",sortable:!0},{name:"auditor",label:e.$t("label.auditor"),field:"auditor",align:"left",type:"java.lang.String",sortable:!0},{name:"info",label:e.$t("label.info"),field:"info",align:"left",type:"java.lang.String",sortable:!0}]},e.do_init()},beforeUpdate(){this.do_init()},methods:{get_pagination(e){let t=this,f=e?.pagination?e.pagination:t.table.pagination;return f?(t.table.pagination=f,f):t.table.pagination},is_field_visible(e){return e.type==="[B"||e.lob===!0?!1:e.type==="java.lang.String"?e.length<=255:!0},create_search_filters(){let e=this,t=e.table.columns,f=e.table.visibles;e.search={filters:[],empty:!0};for(const a of t)if(f.includes(a.name)){let u=!0,r={name:a.name,label:a.label,timestamp:a.timestamp,pattern:a.pattern};a.timestamp===!0?(r.type="datetime",r.condition="BETWEEN",n.isString(a.format)&&(r.pattern=a.format)):a.type==="java.lang.String"?(r.type=a.length>100?"words":"text",r.condition="ANY_LIKE"):a.type==="java.lang.Character"?(r.type="text",r.condition="EQUAL"):a.type==="java.time.LocalDateTime"?(r.type="datetime",r.pattern=a.format,r.condition="BETWEEN"):a.type==="java.lang.Integer"||a.type==="java.lang.Long"?(r.type="number",r.condition="EQUAL"):u=!1,u&&e.search.filters.push(r)}},do_init(){let e=this,t=e.$route.query.handler,f=e.$route.query.manager,a=e.$route.query.type;if(t===e.handler&&f===e.manager&&a===e.type)return;let u="YYYY-MM-DD HH:mm:ss";e.handler=t,e.manager=f,e.type=a,e.type!=="_"?(e.table.columns=[...e.definition.entity.columns],e.table.visibles=[...e.definition.entity.visibles],C.call({path:"/audit/info",params:{handler:e.handler,type:e.type,manager:e.manager},onSuccess(r){if(n.isObject(r)){e.info=r;for(const o of e.info.fields){e.is_field_visible(o)&&e.table.visibles.push("content."+o.name);let p=!0,l={name:"content."+o.name,label:o.label,field:"content",align:"left",type:o.type,sortable:!0,format:function(i){let s=n.isObject(i)?n.getFieldValue(o.name,i):i;return s=n.isObject(s)?JSON.stringify(s):s,s}};n.isString(o.format)&&(l.pattern=o.format),e.info.isSoftDelete===!0&&o.name==="deletedOn"?(l.timestamp=!0,l.pattern=n.isString(o.format)?o.format:u,l.format=function(i){try{return n.format.date(n.getFieldValue("deletedOn",i),{format:u})}catch(s){return n.log(s),i}}):e.info.isAudit===!0&&(o.name==="createdOn"?(l.timestamp=!0,l.pattern=n.isString(o.format)?o.format:u,l.format=function(i){try{return n.format.date(n.getFieldValue("createdOn",i),{format:u})}catch(s){return n.log(s),i}}):o.name==="updatedOn"?(l.timestamp=!0,l.pattern=n.isString(o.format)?o.format:u,l.format=function(i){try{return n.format.date(n.getFieldValue("updatedOn",i),{format:u})}catch(s){return n.log(s),i}}):(o.name==="createdBy"||o.name==="updatedBy")&&(p=!1)),p&&e.table.columns.push(l)}e.create_search_filters(),e.do_request()}}})):(e.table.columns=[...e.definition.default.columns],e.table.visibles=[...e.definition.default.visibles],e.create_search_filters(),e.do_request())},do_request(e){let t=this,{page:f,rowsPerPage:a,sortBy:u,descending:r}=t.get_pagination(e),o=[],p=t.search;if(!p.empty){let i,s;for(const d of p.filters)if(i=n.isDefined(d.value)?d.value:"",i!=="")if(d.condition==="BETWEEN")s=n.isDefined(d.value2)?d.value2:"",s!==""&&(d.type==="datetime"&&d.timestamp===!0&&(i=n.parse.epoch(i,{format:d.pattern||null}),s=n.parse.epoch(s,{format:d.pattern||null})),o.push({field:d.name,condition:d.condition,values:[i,s]}));else{d.type==="datetime"&&d.timestamp===!0&&(i=n.parse.epoch(i,{format:d.pattern||null}));let g=d.or;if(n.isString[g]&&(g=[g]),g=n.isArray(g)?g:[],g.length){let j={logical:"and",filters:[]};for(let _=0;_<g.length;_++)j.filters.push({field:g[_],logical:_===0?"and":"or",condition:d.condition,value:i});o.push(j)}else o.push({field:d.name,condition:d.condition,value:i})}}let l={page:{index:f,size:a,count:t.table.pagination.count===!0},filters:o,manager:t.manager};t.type!=="_"&&(l.entity=t.type),u&&(l.orders=[(r?"-":"")+u]),t.table.loading=!0,C.call({path:"/audit/list",method:"post",params:{handler:t.handler},data:l,onFinish(){t.table.loading=!1},onSuccess(i){if(n.isObject(i)){t.table.rows=n.isArray(i.data)?i.data:[];let s=t.table.pagination;if(s.page=i.index,s.rowsPerPage=i.size,n.isNumber(i.records))s.rowsNumber=i.records;else{let d=i.index*i.size;t.table.rows.length!==i.size?s.rowsNumber=d:s.rowsNumber=d+1}}}})},on_search_click(){let e=this;e.dialog.search={show:!0,parameters:{filters:e.search.filters}}},on_close_dialog_search(e){let t=this;if(n.isArray(e)){let f=t.search;f.filters=e,f.empty=!0;for(const a of f.filters){let u=n.isDefined(a.value)?a.value:"",r=n.isDefined(a.value2)?a.value2:"";if(u!==""||r!==""){f.empty=!1;break}}t.dialog.search={show:!1,parameters:null},t.table.pagination.page=1,t.do_request({pagination:t.table.pagination})}},on_refresh_click(){let e=this;e.table.rows?.length||e.table.pagination.page>1&&(e.table.pagination.page=1),e.do_request({pagination:e.table.pagination})},on_view_click(e){let t=this;t.dialog.view={show:!0,parameters:{scope:e,columns:t.table.columns}}},on_page_changed(){let e=this,t=+e.table.pagination.page;!isNaN(t)&&t>0&&e.do_request({pagination:e.table.pagination})}}},I={class:"full-width row flex-center text-accent q-gutter-sm"},T={class:"text-subtitle2"},U={class:"text-caption"};function R(e,t,f,a,u,r){const o=N("Search"),p=N("View");return v(),P(Q,null,[m(z,{class:"table-sticky-header q-ma-sm",rows:a.table.rows,columns:a.table.columns,"visible-columns":a.table.visibles,loading:a.table.loading,selection:"single",pagination:a.table.pagination,"onUpdate:pagination":t[1]||(t[1]=l=>a.table.pagination=l),dense:e.$q.screen.lt.md,"no-data-label":e.$t("error.data_not_available"),"rows-per-page-label":" ","selected-rows-label":l=>{},"rows-per-page-options":[20,40,60,80,100,120,140,160,180,200],"binary-state-sort":"",separator:"cell",onRequest:r.do_request,bordered:""},{top:c(()=>[m(A),m(y,{glossy:"",round:"",dense:"",class:"q-ma-none q-ml-md",color:"deep-orange",icon:"search",onClick:r.on_search_click},{default:c(()=>[a.search.empty?k("",!0):(v(),w(H,{key:0,class:"led-green",floating:""})),m(V,null,{default:c(()=>[q(h(e.$t("label.search")),1)]),_:1})]),_:1},8,["onClick"]),m(y,{glossy:"",round:"",dense:"",class:"q-ma-none q-ml-md",color:"indigo",icon:"refresh",loading:a.table.loading,onClick:r.on_refresh_click},{default:c(()=>[m(V,null,{default:c(()=>[q(h(e.$t("label.refresh")),1)]),_:1})]),_:1},8,["loading","onClick"])]),"no-data":c(({message:l})=>[S("div",I,[m(B,{size:"2em",name:"block"}),S("span",T,h(l),1)])]),loading:c(()=>[m(L,{showing:"",color:"primary"})]),"body-selection":c(l=>[m(y,{glossy:"",round:"",dense:"",size:"sm",class:"q-ma-none q-ml-xs q-mr-sm",color:"deep-purple",icon:"visibility",onClick:i=>r.on_view_click(l)},{default:c(()=>[m(V,null,{default:c(()=>[q(h(e.$t("label.view")),1)]),_:1})]),_:2},1032,["onClick"])]),pagination:c(l=>[l.pagesNumber>2?(v(),w(y,{key:0,glossy:"",size:"sm",icon:"first_page",color:"grey-8",round:"",dense:"",flat:"",disable:l.isFirstPage,onClick:l.firstPage},null,8,["disable","onClick"])):k("",!0),m(y,{glossy:"",size:"sm",icon:"chevron_left",color:"grey-8",class:"q-ml-sm q-mr-xs",round:"",dense:"",flat:"",disable:l.isFirstPage,onClick:l.prevPage},null,8,["disable","onClick"]),m(O,{dense:"",borderless:"",type:"number","input-class":"text-center q-ml-xs q-mr-xs","input-style":"max-width: 60px;",modelValue:a.table.pagination.page,"onUpdate:modelValue":[t[0]||(t[0]=i=>a.table.pagination.page=i),r.on_page_changed]},F({_:2},[a.table.pagination.count===!0?{name:"append",fn:c(()=>[S("span",U," / "+h(l.pagesNumber),1)]),key:"0"}:void 0]),1032,["modelValue","onUpdate:modelValue"]),m(y,{glossy:"",size:"sm",icon:"chevron_right",color:"grey-8",class:"q-ml-sm q-mr-sm",round:"",dense:"",flat:"",disable:l.isLastPage,onClick:l.nextPage},null,8,["disable","onClick"]),l.pagesNumber>2&&a.table.pagination.count===!0?(v(),w(y,{key:1,glossy:"",size:"sm",icon:"last_page",color:"grey-8",round:"",dense:"",flat:"",disable:l.isLastPage,onClick:l.lastPage},null,8,["disable","onClick"])):k("",!0)]),_:1},8,["rows","columns","visible-columns","loading","pagination","dense","no-data-label","onRequest"]),m(D,{modelValue:a.dialog.search.show,"onUpdate:modelValue":t[2]||(t[2]=l=>a.dialog.search.show=l),persistent:"","transition-show":"slide-down","transition-hide":"none"},{default:c(()=>[m(o,{parameters:a.dialog.search.parameters,onClose:r.on_close_dialog_search},null,8,["parameters","onClose"])]),_:1},8,["modelValue"]),m(D,{modelValue:a.dialog.view.show,"onUpdate:modelValue":t[3]||(t[3]=l=>a.dialog.view.show=l),persistent:"","transition-show":"slide-down","transition-hide":"none"},{default:c(()=>[m(p,{parameters:a.dialog.view.parameters},null,8,["parameters"])]),_:1},8,["modelValue"])],64)}const te=x(M,[["render",R]]);export{te as default};
