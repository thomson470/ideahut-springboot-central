const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/FormV-BY0RTSZC.js","assets/format-DSJ2X3bs.js","assets/index-P44lIENJ.js","assets/index-CWourn4h.css","assets/QTooltip-9usYVsV3.js","assets/ClosePopup-dgko-JG3.js","assets/TouchPan-CvehtYGM.js","assets/Index-09v2zuFp.js","assets/QSpace-CirYgUHy.js","assets/QSelect-CS6ORECd.js","assets/QList-Bzhuo3b5.js","assets/QInnerLoading-E0vqNTz4.js","assets/QTable-yqnelvyL.js","assets/Table2-YHlMfhss.js"])))=>i.map(i=>d[i]);
import{_ as S,al as q,ap as C,Y as E,Z as p,r as b,a0 as h,$ as L,a3 as P,a4 as o,ac as m,f,a5 as g,C as Q,a2 as y,an as j,ab as F,a7 as A,a8 as I,a6 as x,F as w,ad as v,ak as U,aa as V,ao as B,am as T}from"./index-P44lIENJ.js";import{Q as N,b as D,a as R}from"./format-DSJ2X3bs.js";import{Q as O}from"./QTooltip-9usYVsV3.js";import{C as z}from"./ClosePopup-dgko-JG3.js";import{T as G}from"./TouchPan-CvehtYGM.js";import{g as a}from"./Index-09v2zuFp.js";import"./QSpace-CirYgUHy.js";import"./QSelect-CS6ORECd.js";import"./QList-Bzhuo3b5.js";import"./QInnerLoading-E0vqNTz4.js";import"./QTable-yqnelvyL.js";let t;const Y={props:["parameters"],components:{FormV:q(()=>C(()=>import("./FormV-BY0RTSZC.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]))),Table2:q(()=>C(()=>import("./Table2-YHlMfhss.js"),__vite__mapDeps([13,2,3,1,4,9,8,10,11,12,6,7])))},setup(){return{APP:E,util:p,title:b(null),fields:b([]),template:b(null),forms:b([]),tables:b([]),loading:b({}),replica:b(null),dialog:b({main:h.dialog.init(()=>t.dialog.main),form:h.dialog.init(),table:h.dialog.init()})}},created(){t=this;let r=a.get.object(t.parameters),s=a.get.object(r.row),n=a.get.object(r.template);t.title=p.isString(r.title)?r.title:n.title,t.replica=a.get.number(r.replica,null),t.fields=[];let e=a.get.array(n.table.columns),u,i=!1;for(const d of e)!i&&n.id.fields.includes(d.field)&&(i=!0),u=p.getFieldValue(d.field,s),p.isFunction(d.format)&&(u=d.format(u,s)),t.fields.push({label:d.label,value:u});if(!i){let d=a.id.toPk(n.id,s);p.isDefined(d)&&d!==null&&t.fields.splice(0,0,{label:"ID",value:d})}t.forms=a.get.array(n.forms),t.tables=a.get.array(n.children),t.template=n},methods:{on_form_click(r,s){let n=a.get.object(t.parameters),e=a.get.object(n.template),u=a.get.object(n.row),i=a.get.array(r.relations);if(!i.length){h.error("error.required","label.relation");return}let d=[];for(const l of i)d.push({field:l.target,condition:"EQUAL",value:p.getFieldValue(l.source,u)});let _=a.copy(r.crud);_.filters=p.isArray(_.filters)?_.filters:[],_.filters=_.filters.concat(d),p.isNumber(t.replica)&&(_.replica=t.replica),t.loading["form_"+s]=!0,L.call({path:"/crud/single",method:"post",data:_,onFinish(){t.loading["form_"+s]=!1},onSuccess(l){l=a.get.object(l),a.inject.pkAndGridId(r.id,l,e._grid_id_),h.dialog.show(t.dialog.form,{template:e,form:r,data:l,replica:t.replica})}})},on_table_click(r){let s=a.get.object(t.parameters),n=a.get.object(s.template),e=a.get.object(s.row),u=a.copy(a.get.array(r.relations));if(!u.length){h.error("error.required","label.relation");return}for(const i of u)i.value=p.getFieldValue(i.source,e);r._grid_id_=n._grid_id_,h.dialog.show(t.dialog.table,{template:n,definition:r,parentRow:e,relations:u,onlyView:!0,replica:t.replica})},on_close_dialog_table(){h.dialog.hide(t.dialog.table)}}},Z={key:0},H={key:0,class:"q-mb-xs",style:{width:"100%"}},J={key:1,class:"q-mb-xs",style:{width:"100%"}},K={key:1},M={key:0,class:"q-mb-xs",style:{width:"100%"}},W={key:1,class:"q-mb-xs",style:{width:"100%"}};function X(r,s,n,e,u,i){const d=P("FormV"),_=P("Table2");return o(),m(w,null,[f(B,{style:F("width: "+(r.$q.screen.lt.md?"100%;":"50%;")+e.dialog.main.style)},{default:g(()=>[Q((o(),y(j,{class:"header-main",style:F(e.APP?.color?.header?"background: "+e.APP.color.header+" !important;":"")},{default:g(()=>[f(N,{class:"q-pr-none"},{default:g(()=>[f(D,null,{default:g(()=>[f(R,{class:"text-h6 text-white"},{default:g(()=>[A(I(e.title),1)]),_:1})]),_:1}),f(D,{side:""},{default:g(()=>[Q((o(),y(x,{class:"text-caption text-white q-pl-xs q-pr-xs q-mr-xs",flat:"",round:"",glossy:"",icon:"close"},{default:g(()=>[f(O,null,{default:g(()=>[A(I(r.$t("label.close")),1)]),_:1})]),_:1})),[[z]])]),_:1})]),_:1})]),_:1},8,["style"])),[[G,e.dialog.main.onDrag,void 0,{mouse:!0}]]),f(j,{style:{"max-height":"75vh"},class:"q-pa-xs q-mt-none scroll"},{default:g(()=>[(o(!0),m(w,null,v(e.fields,(l,c)=>(o(),y(U,{type:"text",key:c,label:l.label,modelValue:l.value,"onUpdate:modelValue":k=>l.value=k,readonly:"",filled:"",autogrow:"",class:"q-mb-xs",style:{"max-height":"200px",overflow:"scroll"}},null,8,["label","modelValue","onUpdate:modelValue"]))),128)),e.template.childrenFirst?(o(),m("div",Z,[e.tables.length?(o(),m("div",H,[(o(!0),m(w,null,v(e.tables,(l,c)=>(o(),y(x,{key:c,label:l.title,class:"full-width q-mt-xs q-mb-xs text-weight-bold","no-caps":"",glossy:"",onClick:k=>i.on_table_click(l)},null,8,["label","onClick"]))),128))])):V("",!0),e.forms.length?(o(),m("div",J,[(o(!0),m(w,null,v(e.forms,(l,c)=>(o(),y(x,{key:c,label:l.title,class:"full-width q-mt-xs q-mb-xs text-weight-bold","no-caps":"",glossy:"",loading:e.loading["form_"+c],onClick:k=>i.on_form_click(l,c)},null,8,["label","loading","onClick"]))),128))])):V("",!0)])):(o(),m("div",K,[e.forms.length?(o(),m("div",M,[(o(!0),m(w,null,v(e.forms,(l,c)=>(o(),y(x,{key:c,label:l.title,class:"full-width q-mt-xs q-mb-xs text-weight-bold","no-caps":"",glossy:"",loading:e.loading["form_"+c],onClick:k=>i.on_form_click(l,c)},null,8,["label","loading","onClick"]))),128))])):V("",!0),e.tables.length?(o(),m("div",W,[(o(!0),m(w,null,v(e.tables,(l,c)=>(o(),y(x,{key:c,label:l.title,class:"full-width q-mt-xs q-mb-xs text-weight-bold","no-caps":"",glossy:"",onClick:k=>i.on_table_click(l)},null,8,["label","onClick"]))),128))])):V("",!0)]))]),_:1})]),_:1},8,["style"]),f(T,{modelValue:e.dialog.form.show,"onUpdate:modelValue":s[0]||(s[0]=l=>e.dialog.form.show=l),persistent:"","transition-show":"slide-down","transition-hide":"none","backdrop-filter":"blur(1px)"},{default:g(()=>[f(d,{parameters:e.dialog.form.parameters},null,8,["parameters"])]),_:1},8,["modelValue"]),f(T,{modelValue:e.dialog.table.show,"onUpdate:modelValue":s[1]||(s[1]=l=>e.dialog.table.show=l),"transition-show":"slide-down","transition-hide":"none","backdrop-filter":"blur(1px)","full-height":""},{default:g(()=>[f(_,{parameters:e.dialog.table.parameters,onClose:i.on_close_dialog_table},null,8,["parameters","onClose"])]),_:1},8,["modelValue"])],64)}const ce=S(Y,[["render",X]]);export{ce as default};
